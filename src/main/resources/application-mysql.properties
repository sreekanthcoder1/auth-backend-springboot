# ================================================================
# PRODUCTION MYSQL CONFIGURATION - PERSISTENT DATABASE
# ================================================================
# This configuration provides efficient MySQL integration for production
# Use this profile for persistent data storage with optimized performance

# Server Configuration
server.port=${PORT:8080}
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on-param

# ================================================================
# MYSQL DATABASE CONFIGURATION - MULTI-ENVIRONMENT SUPPORT
# ================================================================
# Priority: DATABASE_URL > MYSQL_URL > Local MySQL > Fallback H2

# Primary MySQL Configuration (for most cloud providers)
spring.datasource.url=${DATABASE_URL:${MYSQL_URL:jdbc:mysql://localhost:3306/authdb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&createDatabaseIfNotExist=true}}
spring.datasource.username=${DATABASE_USERNAME:${MYSQL_USER:root}}
spring.datasource.password=${DATABASE_PASSWORD:${MYSQL_PASSWORD:}}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate Configuration for MySQL
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.database=mysql
spring.jpa.generate-ddl=true
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.defer-datasource-initialization=false

# Hibernate Properties for Performance
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.connection.characterEncoding=utf8
spring.jpa.properties.hibernate.connection.CharSet=utf8
spring.jpa.properties.hibernate.connection.useUnicode=true

# SQL Initialization
spring.sql.init.mode=always
spring.sql.init.continue-on-error=true
spring.sql.init.platform=mysql

# ================================================================
# CONNECTION POOL OPTIMIZATION - PRODUCTION SETTINGS
# ================================================================
# HikariCP optimized for MySQL production workloads
spring.datasource.hikari.maximum-pool-size=${DB_MAX_CONNECTIONS:20}
spring.datasource.hikari.minimum-idle=${DB_MIN_CONNECTIONS:5}
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.pool-name=AuthHikariCP

# MySQL specific HikariCP settings
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.prepStmtCacheSize=250
spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit=2048
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true
spring.datasource.hikari.data-source-properties.useLocalSessionState=true
spring.datasource.hikari.data-source-properties.rewriteBatchedStatements=true
spring.datasource.hikari.data-source-properties.cacheResultSetMetadata=true
spring.datasource.hikari.data-source-properties.cacheServerConfiguration=true
spring.datasource.hikari.data-source-properties.elideSetAutoCommits=true
spring.datasource.hikari.data-source-properties.maintainTimeStats=false

# ================================================================
# JWT CONFIGURATION
# ================================================================
app.jwt.secret=${JWT_SECRET:ProductionMySQLJWTSecret123456789012345678901234567890SECURE}
app.jwt.expiration-ms=${JWT_EXPIRATION:86400000}

# ================================================================
# CORS CONFIGURATION
# ================================================================
spring.web.cors.allowed-origins=${CORS_ORIGINS:https://*.onrender.com,https://*.railway.app,https://*.herokuapp.com,https://*.vercel.app,http://localhost:3000,http://localhost:5173}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH,HEAD
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600
spring.web.cors.exposed-headers=Authorization,Content-Type

# ================================================================
# SPRING BOOT ACTUATOR - HEALTH MONITORING
# ================================================================
management.endpoints.web.exposure.include=health,info,metrics,env
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.endpoint.health.probes.enabled=true
management.endpoint.health.group.readiness.include=readinessState,db
management.endpoint.health.group.liveness.include=livenessState

# Health check configuration
management.health.defaults.enabled=true
management.health.db.enabled=true
management.health.diskspace.enabled=true
management.health.ping.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Custom health check timeout for MySQL
management.endpoint.health.cache.time-to-live=30s

# ================================================================
# EMAIL CONFIGURATION
# ================================================================
app.sendgrid.api-key=${SENDGRID_API_KEY:}
app.email.from=${EMAIL_FROM:noreply@yourapp.com}
app.email.enabled=${EMAIL_ENABLED:true}

# ================================================================
# WEBHOOK CONFIGURATION
# ================================================================
app.n8n.webhook-url=${N8N_WEBHOOK_URL:}

# ================================================================
# LOGGING CONFIGURATION - PRODUCTION OPTIMIZED
# ================================================================
logging.level.com.example.authbackend=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.springframework.boot.actuator=INFO
logging.level.org.hibernate=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql=WARN
logging.level.com.zaxxer.hikari=WARN
logging.level.com.mysql.cj=WARN

# Logging pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Log file configuration (optional)
logging.file.name=${LOG_FILE_PATH:logs/auth-backend.log}
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# ================================================================
# SECURITY CONFIGURATION
# ================================================================
server.servlet.session.cookie.secure=${COOKIE_SECURE:true}
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict
server.servlet.session.timeout=30m
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# Security headers
server.servlet.session.tracking-modes=cookie

# ================================================================
# PERFORMANCE OPTIMIZATIONS
# ================================================================
spring.jpa.open-in-view=false
spring.main.lazy-initialization=false

# Connection and query optimization
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.query.conventional_java_constants=true

# ================================================================
# ERROR HANDLING
# ================================================================
server.error.whitelabel.enabled=false
server.error.path=/error
server.error.include-exception=false

# ================================================================
# GRACEFUL SHUTDOWN
# ================================================================
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# ================================================================
# ENVIRONMENT DETECTION
# ================================================================
app.environment.mysql=true
app.environment.persistent=true
app.database.type=mysql
app.debug.startup-info=true

# ================================================================
# PROFILE CONFIGURATION
# ================================================================
spring.profiles.active=mysql

# ================================================================
# APPLICATION SPECIFIC SETTINGS
# ================================================================
app.name=Auth Backend with MySQL
app.version=1.0.0
app.description=Production authentication backend with persistent MySQL storage

# Database migration settings
app.database.migration.enabled=${DB_MIGRATION_ENABLED:true}
app.database.backup.enabled=${DB_BACKUP_ENABLED:false}

# Cache configuration (optional - for future enhancement)
spring.cache.type=${CACHE_TYPE:simple}

# ================================================================
# MONITORING AND METRICS
# ================================================================
management.metrics.enabled=true
management.metrics.export.prometheus.enabled=${PROMETHEUS_ENABLED:false}
management.info.build.enabled=true
management.info.git.enabled=true
management.info.env.enabled=true
